{% extends "base.html" %}
{% block content %}

<div class="section s-blue">
  <div class="section-h">
    <h3 style="margin:0">Finance — add entry</h3>
    <span class="muted">Track credits / debits. All USD.</span>
  </div>
  <form method="post" action="{{ url_for('finance_add') }}">
    <div class="form-row">
      <input type="date" name="date" required>
      <select name="type">
        <option value="credit">Credit</option>
        <option value="debit">Debit</option>
      </select>
      <input name="category" placeholder="Category (e.g., Logistics, Payroll, Ops)" required>
      <input name="description" placeholder="Description" required>
      <input type="number" step="0.01" name="amount_usd" placeholder="Amount USD" required>
      <button class="btn">Save</button>
    </div>
  </form>
</div>

<div class="section s-teal">
  <div class="section-h">
    <h3 style="margin:0">Finance — filter & summary</h3>
    <span class="muted">Filter by month, category, or search text</span>
  </div>
  <form method="get" action="{{ url_for('finance') }}">
    <div class="form-row">
      <input type="month" name="m" value="{{ sel_month or '' }}">
      <input name="c" value="{{ sel_cat or '' }}" placeholder="Category contains…">
      <input name="q" value="{{ q or '' }}" placeholder="Search description…">
      <button class="btn">Apply</button>
      <a class="btn ghost" href="{{ url_for('finance') }}">Clear</a>
    </div>
  </form>

  <div class="grid">
    <div class="card">
      <div class="muted">Current selection balance</div>
      <div class="v">${{ '%.2f'|format(balance or 0) }}</div>
    </div>
    <div class="card">
      <div class="muted">Months in view</div>
      <div class="v">{{ months|length }}</div>
    </div>
  </div>

  <div class="table-wrap">
    <table class="table">
      <tr><th>Month</th><th class="num">Credits</th><th class="num">Debits</th><th class="num">Net</th></tr>
      {% for m in months %}
        {% set s = month_sum[m] %}
        <tr>
          <td>{{ m }}</td>
          <td class="num">${{ '%.2f'|format(s.credit or 0) }}</td>
          <td class="num">${{ '%.2f'|format(s.debit or 0) }}</td>
          <td class="num total">${{ '%.2f'|format((s.credit or 0) - (s.debit or 0)) }}</td>
        </tr>
      {% endfor %}
      {% if not months %}
        <tr><td colspan="4" class="muted">No entries yet</td></tr>
      {% endif %}
    </table>
  </div>
</div>

<div class="section s-green">
  <div class="section-h">
    <h3 style="margin:0">Finance — entries</h3>
    <span class="muted">Newest first</span>
  </div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Date</th><th>Type</th><th>Category</th><th>Description</th><th class="num">Amount USD</th></tr>
      {% for it in items %}
        <tr>
          <td>{{ it.date }}</td>
          <td><span class="badge {{ 'ok' if it.type=='credit' else 'danger' }}">{{ it.type }}</span></td>
          <td>{{ it.category }}</td>
          <td>{{ it.description }}</td>
          <td class="num {{ 'total' if it.type=='credit' else '' }}">
            {{ '-' if it.type=='debit' else '' }}${{ '%.2f'|format(it.amount_usd or 0) }}
          </td>
        </tr>
      {% endfor %}
      {% if not items %}
        <tr><td colspan="5" class="muted">No finance entries recorded</td></tr>
      {% endif %}
    </table>
  </div>
</div>

{% endblock %}
