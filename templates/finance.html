{% extends "base.html" %}
{% block content %}
<h2>Finance</h2>

<div class="section s-blue">
  <div class="section-h"><h3>Filter</h3><span class="muted">Month / Category / Search</span></div>
  <form method="get" action="{{ url_for('finance') }}">
    <div class="form-row">
      <input type="month" name="m" value="{{ sel_month or '' }}">
      <input name="c" placeholder="Category contains…" value="{{ sel_cat or '' }}">
      <input name="q" placeholder="Search description…" value="{{ q or '' }}">
      <button class="btn">Apply</button>
      <a class="btn ghost" href="{{ url_for('finance') }}">Clear</a>
    </div>
  </form>
</div>

<div class="section s-teal">
  <div class="section-h"><h3>Summary by Month</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Month</th><th class="num">Credits</th><th class="num">Debits</th><th class="num">Net</th></tr>
      {% for m in months %}
        {% set s = month_sum[m] %}
        <tr>
          <td>{{ m }}</td>
          <td class="num">${{ '%.2f'|format(s.credit or 0) }}</td>
          <td class="num">${{ '%.2f'|format(s.debit or 0) }}</td>
          <td class="num total">${{ '%.2f'|format((s.credit or 0) - (s.debit or 0)) }}</td>
        </tr>
      {% endfor %}
      {% if not months %}
        <tr><td colspan="4" class="muted">No entries yet.</td></tr>
      {% endif %}
    </table>
  </div>
</div>

<div class="section s-green">
  <div class="section-h"><h3>Entries</h3><span class="muted">Newest first</span></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Date</th><th>Type</th><th>Category</th><th>Description</th><th class="num">Amount USD</th></tr>
      {% for it in items %}
        <tr>
          <td>{{ it.date }}</td>
          <td><span class="badge {{ 'ok' if it.type=='credit' else 'danger' }}">{{ it.type }}</span></td>
          <td>{{ it.category }}</td>
          <td>{{ it.description }}</td>
          <td class="num {{ 'total' if it.type=='credit' else '' }}">
            {{ '-' if it.type=='debit' else '' }}${{ '%.2f'|format(it.amount_usd or 0) }}
          </td>
        </tr>
      {% endfor %}
      {% if not items %}
        <tr><td colspan="5" class="muted">No finance entries recorded.</td></tr>
      {% endif %}
    </table>
  </div>
</div>
{% endblock %}
