{% extends "base.html" %}
{% block content %}
<h2>{{ product.product_name }} ({{ product.product_sku }})</h2>

<div class="section s-green">
  <div class="section-h"><h3>Stock by Country</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th class="num">Qty</th></tr>
      {% for r in stock_rows %}
      <tr><td>{{ r.country }}</td><td class="num">{{ r.qty }}</td></tr>
      {% endfor %}
      <tr><td class="total">TOTAL</td><td class="num total">{{ stock_total }}</td></tr>
    </table>
  </div>
</div>

<div class="section s-blue">
  <div class="section-h"><h3>Ad Spend by Country</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th>Platform</th><th class="num">Amount (USD)</th></tr>
      {% for c,rows in spend_by_country.items() %}
        {% for r in rows %}
        <tr><td>{{ c }}</td><td>{{ r.platform }}</td><td class="num">${{ '%.2f'|format(r.amount_usd) }}</td></tr>
        {% endfor %}
      {% endfor %}
    </table>
  </div>
</div>

<div class="section s-orange">
  <div class="section-h"><h3>Shipments</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Ref</th><th>From</th><th>To</th><th>Status</th><th>Qty</th><th>Shipping USD</th></tr>
      {% for s in shipments %}
      <tr>
        <td>{{ s.ref }}</td><td>{{ s.from_country }}</td><td>{{ s.to_country }}</td>
        <td>{{ s.status }}</td><td class="num">{{ s.qty_sum }}</td><td class="num">${{ '%.2f'|format(s.shipping_cost_usd) }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>

<div class="section s-purple">
  <div class="section-h"><h3>Profit Summary</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th class="num">Pieces</th><th class="num">Revenue</th><th class="num">Ads</th><th class="num">Profit</th><th class="num">Per Piece</th></tr>
      {% for r in profit_rows %}
      <tr>
        <td>{{ r.country_code }}</td><td class="num">{{ r.pieces }}</td>
        <td class="num">${{ '%.2f'|format(r.revenue_usd) }}</td>
        <td class="num">${{ '%.2f'|format(r.ad_usd) }}</td>
        <td class="num">${{ '%.2f'|format(r.profit_total_usd) }}</td>
        <td class="num">${{ '%.2f'|format(r.profit_per_piece_usd) }}</td>
      </tr>
      {% endfor %}
      <tr>
        <td class="total">TOTAL</td>
        <td class="num total">{{ profit_totals.pieces }}</td>
        <td class="num total">${{ '%.2f'|format(profit_totals.revenue_usd) }}</td>
        <td class="num total">${{ '%.2f'|format(profit_totals.ad_usd) }}</td>
        <td class="num total">${{ '%.2f'|format(profit_totals.profit_total_usd) }}</td>
        <td></td>
      </tr>
    </table>
  </div>
</div>
{% endblock %}
