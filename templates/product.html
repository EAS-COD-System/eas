{% extends "base.html" %}
{% block content %}
<div class="section s-green">
  <div class="section-h"><h3 style="margin:0">{{ product.product_name }}</h3><span class="muted">SKU {{ product.product_sku }}</span></div>
  <div class="grid">
    <div class="card"><div class="muted">CN Cost</div><div class="v">${{ '%.2f'|format(product.cost_cn_usd or 0) }}</div></div>
    <div class="card"><div class="muted">CNâ†’KE /pc</div><div class="v">${{ '%.2f'|format(product.default_cnke_ship_usd or 0) }}</div></div>
    <div class="card"><div class="muted">Profit+Ads (fallback)</div><div class="v">${{ '%.2f'|format(product.profit_ads_budget_usd or 0) }}</div></div>
  </div>
</div>

<div class="section s-green">
  <div class="section-h"><h3 style="margin:0">Stock by country</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th class="num">Qty</th></tr>
      {% for row in stock_rows %}
        <tr><td>{{ row.country }}</td><td class="num">{{ row.qty }}</td></tr>
      {% endfor %}
      <tr><td class="total">TOTAL</td><td class="num total">{{ stock_total }}</td></tr>
    </table>
  </div>
</div>

<div class="section s-blue">
  <div class="section-h"><h3 style="margin:0">Current Daily Spend (USD)</h3><span class="muted">Per country & platform</span></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th>Platform</th><th class="num">USD</th></tr>
      {% for code,rows in spend_by_country.items() %}
        {% for r in rows %}
          <tr><td>{{ code }}</td><td>{{ r.platform }}</td><td class="num">${{ '%.2f'|format(r.amount_usd or 0) }}</td></tr>
        {% endfor %}
      {% endfor %}
      {% if not spend_by_country %}<tr><td colspan="3" class="muted">No spend recorded.</td></tr>{% endif %}
    </table>
  </div>
</div>

<div class="section s-orange">
  <div class="section-h"><h3 style="margin:0">Shipments for this product</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Ref</th><th>From</th><th>To</th><th>Status</th><th class="num">Qty</th><th class="num">Ship USD</th></tr>
      {% for s in shipments %}
      <tr>
        <td>{{ s.ref }}</td><td>{{ s.from_country }}</td><td>{{ s.to_country }}</td>
        <td>{{ s.status }}</td><td class="num">{{ s.qty_sum }}</td><td class="num">${{ '%.2f'|format(s.shipping_cost_usd or 0) }}</td>
      </tr>
      {% endfor %}
      {% if not shipments %}<tr><td colspan="6" class="muted">None</td></tr>{% endif %}
    </table>
  </div>
</div>

<div class="section s-purple">
  <div class="section-h"><h3 style="margin:0">Profit snapshot</h3></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th class="num">Pieces</th><th class="num">Revenue</th><th class="num">Ads</th><th class="num">Profit</th><th class="num">Per piece</th></tr>
      {% for r in profit_rows %}
        <tr>
          <td>{{ r.country_code }}</td>
          <td class="num">{{ r.pieces }}</td>
          <td class="num">${{ '%.2f'|format(r.revenue_usd or 0) }}</td>
          <td class="num">${{ '%.2f'|format(r.ad_usd or 0) }}</td>
          <td class="num total">${{ '%.2f'|format(r.profit_total_usd or 0) }}</td>
          <td class="num">${{ '%.2f'|format(r.profit_per_piece_usd or 0) }}</td>
        </tr>
      {% endfor %}
      <tr>
        <td class="total">TOTAL</td>
        <td class="num total">{{ profit_totals.pieces }}</td>
        <td class="num total">${{ '%.2f'|format(profit_totals.revenue_usd or 0) }}</td>
        <td class="num total">${{ '%.2f'|format(profit_totals.ad_usd or 0) }}</td>
        <td class="num total">${{ '%.2f'|format(profit_totals.profit_total_usd or 0) }}</td>
        <td></td>
      </tr>
    </table>
  </div>
</div>
{% endblock %}
