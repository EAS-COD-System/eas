{% extends "base.html" %}
{% block content %}
<h2>Performance</h2>

<div class="section s-blue">
  <div class="section-h"><h3>Top Delivered — Filter</h3></div>
  <form method="get" action="{{ url_for('performance') }}">
    <div class="form-row">
      <select name="tp">
        <option value="10d" {% if tp=='10d' %}selected{% endif %}>Last 10 days</option>
        <option value="21d" {% if tp=='21d' %}selected{% endif %}>Last 21 days</option>
        <option value="35d" {% if tp=='35d' %}selected{% endif %}>Last 35 days</option>
        <option value="60d" {% if tp=='60d' %}selected{% endif %}>Last 60 days</option>
        <option value="3m" {% if tp=='3m' %}selected{% endif %}>Last 3 months</option>
        <option value="6m" {% if tp=='6m' %}selected{% endif %}>Last 6 months</option>
        <option value="1y" {% if tp=='1y' %}selected{% endif %}>Last 1 year</option>
      </select>
      <select name="tc">
        <option value="" {% if not tc %}selected{% endif %}>All Countries</option>
        {% for code in ctr_codes %}
          <option value="{{ code }}" {% if tc==code %}selected{% endif %}>{{ code }}</option>
        {% endfor %}
      </select>
      <button class="btn">Apply</button>
    </div>
  </form>
</div>

<div class="section s-green">
  <div class="section-h"><h3>Top Delivered — Results</h3><span class="muted">Sorted by profit</span></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th>Product</th><th class="num">Orders</th><th class="num">Pieces</th><th class="num">Revenue USD</th><th class="num">Profit USD</th><th class="num">Profit/pc</th></tr>
      {% for r in top_report %}
      <tr>
        <td>{{ r.country_code }}</td>
        <td>{{ r.product_sku }}</td>
        <td class="num">{{ r.orders }}</td>
        <td class="num">{{ r.pieces }}</td>
        <td class="num">${{ '%.2f'|format(r.revenue_usd or 0) }}</td>
        <td class="num total">${{ '%.2f'|format(r.profit_total_usd or 0) }}</td>
        <td class="num">${{ '%.2f'|format(r.profit_per_piece_usd or 0) }}</td>
      </tr>
      {% endfor %}
      {% if not top_report %}
      <tr><td colspan="7" class="muted">No data for this period.</td></tr>
      {% endif %}
    </table>
  </div>
</div>

<div class="section s-teal">
  <div class="section-h"><h3>Remittance — Current View</h3><span class="muted">Same filter as above</span></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th>Product</th><th class="num">Orders</th><th class="num">Pieces</th><th class="num">Revenue</th><th class="num">Profit</th></tr>
      {% for r in remit_report %}
      <tr>
        <td>{{ r.country_code }}</td>
        <td>{{ r.product_sku }}</td>
        <td class="num">{{ r.orders }}</td>
        <td class="num">{{ r.pieces }}</td>
        <td class="num">${{ '%.2f'|format(r.revenue_usd or 0) }}</td>
        <td class="num total">${{ '%.2f'|format(r.profit_total_usd or 0) }}</td>
      </tr>
      {% endfor %}
      {% if not remit_report %}
      <tr><td colspan="6" class="muted">No remittance rows for this filter.</td></tr>
      {% endif %}
    </table>
  </div>
</div>
{% endblock %}
