{% extends "base.html" %}
{% block content %}
<div class="grid">
  <div class="card kpi"><div class="muted">Active Products</div><div class="v">{{ counts.products }}</div></div>
  <div class="card kpi"><div class="muted">Warehouses</div><div class="v">{{ counts.warehouses }}</div></div>
  <div class="card kpi"><div class="muted">In-Transit</div><div class="v">{{ counts.in_transit }}</div></div>
</div>

<div class="section s-green">
  <div class="section-h"><h3>Country Band</h3><span class="muted">Stock / In-transit / Ad Spend</span></div>
  <div class="grid">
    {% for name,vals in band.items() %}
    <div class="card">
      <div class="muted">{{ vals.code }} — {{ name }}</div>
      <div class="subgrid">
        <div><div class="small muted">Stock</div><div class="v">{{ vals.stock }}</div></div>
        <div><div class="small muted">In-Transit</div><div class="v">{{ vals.in_transit }}</div></div>
        <div><div class="small muted">Ad Spend</div><div class="v">${{ '%.2f'|format(vals.ad_spend) }}</div></div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<div class="section s-blue">
  <div class="section-h"><h3>Ad Spend (USD)</h3></div>
  <form method="post" action="{{ url_for('upsert_current_spend') }}">
    <div class="form-row">
      <select name="platform"><option>Facebook</option><option>TikTok</option><option>Google</option></select>
      <select name="country_code">{% for c in countries %}<option>{{ c.code }}</option>{% endfor %}</select>
      <select name="product_sku">{% for p in all_products %}<option value="{{ p.product_sku }}">{{ p.product_sku }} — {{ p.product_name }}</option>{% endfor %}</select>
      <input type="number" step="0.01" name="amount_usd" placeholder="USD amount">
      <button class="btn">Save</button>
    </div>
  </form>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th class="num">Facebook</th><th class="num">TikTok</th><th class="num">Google</th><th class="num">Total</th></tr>
      {% for c in countries %}
        {% set r = spend_c_summary.get(c.code, {}) %}
        <tr>
          <td>{{ c.code }}</td>
          <td class="num">${{ '%.2f'|format(r.get('Facebook',0)) }}</td>
          <td class="num">${{ '%.2f'|format(r.get('TikTok',0)) }}</td>
          <td class="num">${{ '%.2f'|format(r.get('Google',0)) }}</td>
          <td class="num total">${{ '%.2f'|format(r.get('total',0)) }}</td>
        </tr>
      {% endfor %}
    </table>
  </div>
</div>

<div class="section s-teal">
  <div class="section-h"><h3>Weekly Delivered</h3><span class="muted">{{ week_start }} → {{ week_end }}</span></div>
  <div class="table-wrap">
    <table class="table">
      <tr><th>Country</th><th class="num">Delivered</th></tr>
      {% for c in countries %}
      <tr><td>{{ c.code }}</td><td class="num total">{{ weekly_totals.get(c.code,0) }}</td></tr>
      {% endfor %}
      <tr><td class="total">TOTAL</td><td class="num total">{{ weekly_grand }}</td></tr>
    </table>
  </div>
</div>

<div class="section s-purple">
  <div class="section-h"><h3>Daily Delivered</h3><span class="muted">Recent 8 Days</span></div>
  <form method="post" action="{{ url_for('add_daily_delivered') }}">
    <div class="form-row">
      <input type="date" name="date" required>
      <select name="country_code">{% for c in countries %}<option>{{ c.code }}</option>{% endfor %}</select>
      <input type="number" name="delivered" placeholder="Delivered">
      <button class="btn">Save</button>
    </div>
  </form>

  <div class="table-wrap">
    <table class="table">
      <tr><th>Date</th>{% for code in ctr_codes %}<th class="num">{{ code }}</th>{% endfor %}<th class="num">Total</th></tr>
      {% for r in daily_pivot %}
      <tr>
        <td>{{ r.date }}</td>
        {% for code in ctr_codes %}<td class="num">{{ r[code] }}</td>{% endfor %}
        <td class="num total">{{ r.total }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endblock %}
