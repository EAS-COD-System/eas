{% extends "base.html" %}
{% block content %}

<section class="cards">
  <div class="card">
    <div class="k">Products</div>
    <div class="v">{{ stats.product_count }}</div>
  </div>
  <div class="card">
    <div class="k">Warehouses</div>
    <div class="v">{{ stats.warehouse_count }}</div>
  </div>
  <div class="card">
    <div class="k">In-Transit</div>
    <div class="v">{{ stats.in_transit_count }}</div>
  </div>
</section>

<h2>Country band — totals</h2>
<div class="grid">
  {% for r in country_summaries %}
  <div class="panel">
    <div class="title">{{ r.name }} ({{ r.code }})</div>
    <div>Stock: <b>{{ r.stock }}</b></div>
    <div>In transit: <b>{{ r.in_transit }}</b></div>
    <div>Ad spend: <b>${{ '%.2f'|format(r.spend) }}</b></div>
  </div>
  {% endfor %}
</div>

<h2>Add product</h2>
<form method="post" action="{{ url_for('product_new') }}" class="row">
  <input name="name" placeholder="Name" required>
  <input name="sku" placeholder="SKU" required>
  <input name="cost_cn" type="number" step="0.01" placeholder="Cost CN (USD)">
  <input name="ship_cn_ke" type="number" step="0.01" placeholder="Ship CN→KE (USD)">
  <button>Add</button>
</form>

<h2>Set daily ad spend</h2>
<form method="post" action="{{ url_for('spend_set') }}" class="row">
  <input type="date" name="day" value="{{ today }}">
  <select name="country" required>
    {% for c in countries %}<option value="{{ c.code }}">{{ c.name }}</option>{% endfor %}
  </select>
  <select name="product_id" required>
    {% for p in products %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
  </select>
  <select name="platform" required>
    <option value="facebook">Facebook</option>
    <option value="tiktok">TikTok</option>
    <option value="google">Google</option>
  </select>
  <input name="amount" type="number" step="0.01" placeholder="USD">
  <button>Save</button>
</form>

<h2>Daily delivered (performance)</h2>
<form method="post" action="{{ url_for('delivered_set') }}" class="row">
  <input type="date" name="day" value="{{ today }}">
  <select name="country" required>
    {% for c in countries %}<option value="{{ c.code }}">{{ c.name }}</option>{% endfor %}
  </select>
  <input name="qty" type="number" min="0" placeholder="Delivered pcs">
  <button>Save</button>
</form>

<table class="table">
  <thead>
    <tr>
      <th>Date</th>
      {% for c in countries %}<th>{{ c.code }}</th>{% endfor %}
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    {% for r in perf_rows %}
    <tr>
      <td>{{ r.date }}</td>
      {% for c in countries %}<td>{{ r[c.code] }}</td>{% endfor %}
      <td>{{ r.total }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2>Create shipment</h2>
<form method="post" action="{{ url_for('shipment_new') }}" class="row">
  <input name="ref" placeholder="Ref (optional)">
  <select name="from_country" required>
    {% for c in countries %}<option value="{{ c.code }}">{{ c.name }}</option>{% endfor %}
  </select>
  <select name="to_country" required>
    {% for c in countries %}<option value="{{ c.code }}">{{ c.name }}</option>{% endfor %}
  </select>
  <input type="date" name="eta" placeholder="ETA">
  <input name="ship_cost" type="number" step="0.01" placeholder="Ship cost USD">
  <select name="product_id" required>
    {% for p in products %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
  </select>
  <input name="qty" type="number" min="1" placeholder="Qty">
  <button>Create</button>
</form>

<h3>In transit — China → Kenya</h3>
<ul class="list">
  {% for s in cn_ke %}
    <li>#{{ s.ref }} — items: {{ s.items|length }} — <form style="display:inline" method="post" action="{{ url_for('shipment_arrived', ship_id=s.id) }}"><button>Mark arrived</button></form></li>
  {% else %}
    <li>No shipments in transit.</li>
  {% endfor %}
</ul>

<h3>In transit — between countries</h3>
<ul class="list">
  {% for s in inter %}
    <li>#{{ s.ref }} {{ s.from_country }} → {{ s.to_country }} — <form style="display:inline" method="post" action="{{ url_for('shipment_arrived', ship_id=s.id) }}"><button>Mark arrived</button></form></li>
  {% else %}
    <li>No shipments in transit.</li>
  {% endfor %}
</ul>

{% endblock %}
